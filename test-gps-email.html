<!-- Quick Test Page for GPS Tracking & Email Verification -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test GPS & Email Features</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-container {
            background: white;
            border-radius: 8px;
            padding: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        h1 {
            color: #333;
            border-bottom: 3px solid #007bff;
            padding-bottom: 10px;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            background: #f8f9fa;
            border-left: 4px solid #007bff;
            border-radius: 4px;
        }
        .test-section h2 {
            margin-top: 0;
            color: #007bff;
        }
        .btn {
            display: inline-block;
            padding: 10px 20px;
            margin: 5px 5px 5px 0;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        .btn:hover {
            background: #0056b3;
        }
        .btn-secondary {
            background: #6c757d;
        }
        .btn-secondary:hover {
            background: #5a6268;
        }
        .btn-success {
            background: #28a745;
        }
        .btn-success:hover {
            background: #218838;
        }
        .output {
            background: #f1f1f1;
            padding: 15px;
            border-radius: 4px;
            margin-top: 10px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        .success {
            color: #28a745;
            font-weight: bold;
        }
        .error {
            color: #dc3545;
            font-weight: bold;
        }
        .info {
            color: #007bff;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }
        table td, table th {
            padding: 8px;
            border: 1px solid #ddd;
            text-align: left;
        }
        table th {
            background: #007bff;
            color: white;
        }
        .badge {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 3px;
            font-size: 12px;
            font-weight: bold;
        }
        .badge-success {
            background: #d4edda;
            color: #155724;
        }
        .badge-warning {
            background: #fff3cd;
            color: #856404;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>üß™ GPS Tracking & Email Verification Test Suite</h1>
        <p>This page helps you test the GPS tracking and email verification features.</p>

        <!-- GPS Tracking Tests -->
        <div class="test-section">
            <h2>üìç GPS Tracking Modal Tests</h2>
            <p>Test the delivery tracking modal functionality</p>
            
            <button class="btn btn-success" onclick="testTrackingModal()">Test Tracking Modal - Order #1001</button>
            <button class="btn btn-success" onclick="testTrackingModal(1002)">Test Tracking Modal - Order #1002</button>
            <button class="btn btn-secondary" onclick="testTrackingData()">View Raw Delivery Data</button>
            <button class="btn btn-secondary" onclick="testTrackingModalElement()">Check Modal HTML Element</button>
            
            <div id="tracking-output" class="output"></div>
        </div>

        <!-- Email Verification Tests -->
        <div class="test-section">
            <h2>üìß Email Verification Tests</h2>
            <p>Test the email verification functionality</p>
            
            <button class="btn btn-success" onclick="testEmailVerification()">Test Send Verification Email</button>
            <button class="btn btn-secondary" onclick="checkEmailStatus()">Check Email Status</button>
            <button class="btn btn-secondary" onclick="resetEmailStatus()">Reset Email Status</button>
            
            <div id="email-output" class="output"></div>
        </div>

        <!-- Storage Inspection -->
        <div class="test-section">
            <h2>üíæ Local Storage Inspection</h2>
            <p>View what's stored in browser local storage</p>
            
            <button class="btn btn-secondary" onclick="inspectLocalStorage()">Inspect Local Storage</button>
            <button class="btn btn-secondary" onclick="clearAllData()">Clear All Data (WARNING!)</button>
            
            <div id="storage-output" class="output"></div>
        </div>

        <!-- Navigation Tests -->
        <div class="test-section">
            <h2>üîó Navigation Tests</h2>
            <p>Navigate to pages and test features</p>
            
            <button class="btn" onclick="goToOrders()">Go to My Orders (Test Tracking)</button>
            <button class="btn" onclick="goToProfile()">Go to Profile (Test Email Verification)</button>
            <button class="btn" onclick="goToProducts()">Go to Products</button>
            
            <div id="nav-output" class="output"></div>
        </div>

        <!-- Console Output -->
        <div class="test-section">
            <h2>üìù Console/Debug Output</h2>
            <p>Messages from JavaScript execution</p>
            
            <button class="btn btn-secondary" onclick="clearOutput()">Clear Output</button>
            <button class="btn btn-secondary" onclick="openDevTools()">Open DevTools (F12)</button>
            
            <div id="console-output" class="output"></div>
        </div>
    </div>

    <script src="../js/data.js"></script>
    <script>
        const logOutput = (id, message, type = 'info') => {
            const el = document.getElementById(id);
            if (!el) return;
            
            const timestamp = new Date().toLocaleTimeString();
            const prefix = type === 'success' ? '‚úì' : type === 'error' ? '‚úó' : '‚Ñπ';
            const className = type;
            
            const line = `<span class="${className}">[${timestamp}] ${prefix}</span> ${message}\n`;
            el.appendChild(createSpan(line, className));
            el.scrollTop = el.scrollHeight;
        };

        const createSpan = (text, className) => {
            const span = document.createElement('span');
            if (className) span.className = className;
            span.textContent = text;
            return span;
        };

        const log = (id, msg, type) => logOutput(id, msg, type);

        // GPS TRACKING TESTS
        function testTrackingModal(orderID = 1001) {
            const output = 'tracking-output';
            log(output, `Testing tracking modal for Order #${orderID}...`, 'info');
            
            if (!window.systemData || !window.systemData.deliveries) {
                log(output, 'ERROR: systemData not loaded', 'error');
                return;
            }
            
            const delivery = window.systemData.deliveries.find(d => d.orderID === orderID);
            if (!delivery) {
                log(output, `ERROR: No delivery found for Order #${orderID}`, 'error');
                return;
            }
            
            log(output, `‚úì Found delivery data:`, 'success');
            log(output, `  Status: ${delivery.status}`, 'info');
            log(output, `  Route: ${delivery.route}`, 'info');
            log(output, `  ETA: ${delivery.estimatedTime}`, 'info');
            
            // Test modal element
            const modal = document.getElementById('tracking-modal');
            if (modal) {
                log(output, `‚úì Modal element exists in DOM`, 'success');
                
                // Try to trigger trackDelivery if it exists
                if (typeof trackDelivery === 'function') {
                    log(output, `Calling trackDelivery(${orderID})...`, 'info');
                    trackDelivery(orderID);
                    log(output, `‚úì trackDelivery() executed`, 'success');
                } else {
                    log(output, `ERROR: trackDelivery function not found`, 'error');
                }
            } else {
                log(output, `ERROR: Modal element (#tracking-modal) not found in DOM`, 'error');
            }
        }

        function testTrackingData() {
            const output = 'tracking-output';
            log(output, 'Raw Delivery Data from systemData:', 'info');
            
            if (!window.systemData || !window.systemData.deliveries) {
                log(output, 'ERROR: systemData or deliveries not found', 'error');
                return;
            }
            
            window.systemData.deliveries.forEach(d => {
                log(output, `Order #${d.orderID}: ${d.status} | ${d.route} | ETA: ${d.estimatedTime}`, 'success');
            });
        }

        function testTrackingModalElement() {
            const output = 'tracking-output';
            const modal = document.getElementById('tracking-modal');
            
            if (!modal) {
                log(output, 'ERROR: tracking-modal element not found in DOM', 'error');
                return;
            }
            
            log(output, '‚úì Modal element found', 'success');
            log(output, `Modal HTML: ${modal.outerHTML.substring(0, 200)}...`, 'info');
            log(output, `Modal class: ${modal.className}`, 'info');
            log(output, `Modal display: ${getComputedStyle(modal).display}`, 'info');
            log(output, `Modal z-index: ${getComputedStyle(modal).zIndex}`, 'info');
        }

        // EMAIL VERIFICATION TESTS
        function testEmailVerification() {
            const output = 'email-output';
            log(output, 'Testing email verification...', 'info');
            
            if (typeof sendVerificationEmail === 'function') {
                log(output, 'Calling sendVerificationEmail()...', 'info');
                sendVerificationEmail();
                log(output, '‚úì sendVerificationEmail() executed', 'success');
                
                setTimeout(() => {
                    checkEmailStatus();
                }, 2000);
            } else {
                log(output, 'ERROR: sendVerificationEmail function not found', 'error');
            }
        }

        function checkEmailStatus() {
            const output = 'email-output';
            const user = JSON.parse(localStorage.getItem('user') || '{}');
            
            if (!user.email) {
                log(output, 'No user email found in localStorage', 'error');
                return;
            }
            
            log(output, `Email Address: ${user.email}`, 'info');
            const isVerified = user.email_verified || false;
            const status = isVerified ? '‚úì VERIFIED' : '‚úó NOT VERIFIED';
            log(output, `Verification Status: ${status}`, isVerified ? 'success' : 'warning');
            log(output, `Raw email_verified flag: ${user.email_verified}`, 'info');
        }

        function resetEmailStatus() {
            const output = 'email-output';
            const user = JSON.parse(localStorage.getItem('user') || '{}');
            
            if (confirm('Are you sure you want to reset email verification status?')) {
                user.email_verified = false;
                localStorage.setItem('user', JSON.stringify(user));
                log(output, '‚úì Email verification status reset to NOT VERIFIED', 'success');
                checkEmailStatus();
            }
        }

        // STORAGE INSPECTION
        function inspectLocalStorage() {
            const output = 'storage-output';
            log(output, 'Local Storage Contents:', 'info');
            
            if (localStorage.length === 0) {
                log(output, 'Local storage is empty', 'warning');
                return;
            }
            
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                let value = localStorage.getItem(key);
                
                // Truncate long values
                if (value.length > 100) {
                    value = value.substring(0, 100) + '...';
                }
                
                // Try to parse JSON values
                try {
                    const parsed = JSON.parse(localStorage.getItem(key));
                    log(output, `${key}: [JSON Object]`, 'info');
                    if (key === 'user') {
                        log(output, `  ‚îú‚îÄ name: ${parsed.full_name}`, 'info');
                        log(output, `  ‚îú‚îÄ email: ${parsed.email}`, 'info');
                        log(output, `  ‚îî‚îÄ email_verified: ${parsed.email_verified}`, 'info');
                    }
                } catch(e) {
                    log(output, `${key}: ${value}`, 'info');
                }
            }
        }

        function clearAllData() {
            if (confirm('WARNING: This will delete ALL local storage data. Continue?')) {
                if (confirm('This action cannot be undone. Are you absolutely sure?')) {
                    localStorage.clear();
                    const output = 'storage-output';
                    log(output, '‚úì All local storage cleared', 'success');
                }
            }
        }

        // NAVIGATION
        function goToOrders() {
            const output = 'nav-output';
            log(output, 'Navigating to My Orders page...', 'info');
            setTimeout(() => {
                window.location.href = 'pages/customer/orders.html';
            }, 1000);
        }

        function goToProfile() {
            const output = 'nav-output';
            log(output, 'Navigating to Profile page...', 'info');
            setTimeout(() => {
                window.location.href = 'pages/customer/profile.html';
            }, 1000);
        }

        function goToProducts() {
            const output = 'nav-output';
            log(output, 'Navigating to Products page...', 'info');
            setTimeout(() => {
                window.location.href = 'pages/customer/products.html';
            }, 1000);
        }

        // UTILITIES
        function clearOutput() {
            document.getElementById('console-output').innerHTML = '';
        }

        function openDevTools() {
            alert('Press F12 or Ctrl+Shift+I to open DevTools. Check the Console tab for detailed error messages.');
        }

        // Initialize
        window.addEventListener('load', () => {
            const output = 'console-output';
            log(output, 'Test page loaded', 'success');
            log(output, `Browser: ${navigator.userAgent.substring(0, 80)}...`, 'info');
            log(output, `systemData loaded: ${!!window.systemData}`, 'success');
            log(output, `Deliveries available: ${window.systemData?.deliveries?.length || 0}`, 'success');
        });
    </script>
</body>
</html>
