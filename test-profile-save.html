<!-- Profile Save Test Page -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Profile Save</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 900px;
            margin: 20px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-box {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        h1 { color: #333; border-bottom: 3px solid #007bff; padding-bottom: 10px; }
        h2 { color: #007bff; margin-top: 20px; }
        .btn {
            padding: 10px 20px;
            margin: 5px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        .btn:hover { background: #0056b3; }
        .btn-success { background: #28a745; }
        .btn-success:hover { background: #218838; }
        .output {
            background: #f9f9f9;
            padding: 15px;
            border-left: 4px solid #007bff;
            margin-top: 10px;
            font-family: monospace;
            white-space: pre-wrap;
            word-break: break-all;
            max-height: 300px;
            overflow-y: auto;
        }
        .success { color: #28a745; font-weight: bold; }
        .error { color: #dc3545; font-weight: bold; }
        input, textarea {
            width: 100%;
            padding: 10px;
            margin: 5px 0;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-family: Arial;
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            font-weight: bold;
            display: block;
            margin-bottom: 5px;
        }
    </style>
</head>
<body>
    <h1>ðŸ§ª Profile Save Test Page</h1>

    <div class="test-box">
        <h2>1. Check Current User Data</h2>
        <p>This checks if you're logged in and what data is stored.</p>
        <button class="btn btn-success" onclick="checkUserData()">Check User Data</button>
        <div id="userDataOutput" class="output"></div>
    </div>

    <div class="test-box">
        <h2>2. Create Test User Data</h2>
        <p>This creates test user data in localStorage so you can test the save function.</p>
        <button class="btn btn-success" onclick="createTestUser()">Create Test User</button>
        <div id="createUserOutput" class="output"></div>
    </div>

    <div class="test-box">
        <h2>3. Simulate Profile Save</h2>
        <p>Fill in the form below and click "Simulate Save" to test the save function.</p>
        
        <div class="form-group">
            <label for="testName">Full Name:</label>
            <input type="text" id="testName" placeholder="Enter full name" value="John Test User">
        </div>
        
        <div class="form-group">
            <label for="testPhone">Phone Number:</label>
            <input type="text" id="testPhone" placeholder="Enter phone number" value="+1-555-123-4567">
        </div>
        
        <div class="form-group">
            <label for="testAddress">Address:</label>
            <textarea id="testAddress" placeholder="Enter address" rows="3">123 Test Street, Test City, TC 12345</textarea>
        </div>
        
        <button class="btn btn-success" onclick="simulateSave()">Simulate Save</button>
        <div id="saveOutput" class="output"></div>
    </div>

    <div class="test-box">
        <h2>4. Verify Save Results</h2>
        <p>After saving above, click this to verify the data was saved.</p>
        <button class="btn btn-success" onclick="verifySave()">Verify Save</button>
        <div id="verifyOutput" class="output"></div>
    </div>

    <div class="test-box">
        <h2>5. Test Actual Profile Page</h2>
        <p>Once test passes, go to the actual profile page to test it live.</p>
        <button class="btn" onclick="window.location.href='pages/customer/profile.html'">Go to Profile Page</button>
    </div>

    <div class="test-box">
        <h2>6. Debug Helpers</h2>
        <button class="btn" onclick="openDevTools()">Open DevTools (F12)</button>
        <button class="btn" onclick="clearLocalStorage()">Clear All Data</button>
        <button class="btn" onclick="showAllStorage()">Show All Storage</button>
    </div>

    <script src="../js/data.js"></script>
    <script>
        const log = (id, message, type = 'info') => {
            const el = document.getElementById(id);
            if (!el) return;
            
            const timestamp = new Date().toLocaleTimeString();
            const prefix = type === 'success' ? 'âœ“' : type === 'error' ? 'âœ—' : 'â„¹';
            const className = type;
            
            let line = `[${timestamp}] ${prefix} ${message}\n`;
            
            if (type) {
                line = `<span class="${className}">${line}</span>`;
            }
            
            if (el.innerHTML) el.innerHTML += line;
            else el.textContent += line;
            
            el.scrollTop = el.scrollHeight;
        };

        function checkUserData() {
            const output = 'userDataOutput';
            document.getElementById(output).innerHTML = '';
            
            log(output, 'Checking localStorage for user data...', 'info');
            
            const userStr = localStorage.getItem('user');
            if (!userStr) {
                log(output, 'ERROR: No user data found in localStorage', 'error');
                log(output, 'You may not be logged in. Please log in first at index.html', 'error');
                return;
            }
            
            try {
                const user = JSON.parse(userStr);
                log(output, 'User data found!', 'success');
                log(output, `Full Name: ${user.full_name || '(not set)'}`, 'info');
                log(output, `Phone: ${user.phone || '(not set)'}`, 'info');
                log(output, `Address: ${user.address || '(not set)'}`, 'info');
                log(output, `Email: ${user.email || '(not set)'}`, 'info');
                log(output, `Raw data: ${JSON.stringify(user, null, 2)}`, 'info');
            } catch (e) {
                log(output, `ERROR parsing user data: ${e.message}`, 'error');
            }
        }

        function createTestUser() {
            const output = 'createUserOutput';
            document.getElementById(output).innerHTML = '';
            
            log(output, 'Creating test user data...', 'info');
            
            const testUser = {
                id: 1,
                userID: 1,
                email: 'testuser@example.com',
                full_name: 'Test User',
                phone: '555-0000',
                address: '123 Test St',
                joined: new Date().toLocaleDateString(),
                totalOrders: 3,
                totalSpent: 450,
                pendingOrders: 1,
                deliveredOrders: 2,
                role: 'customer'
            };
            
            localStorage.setItem('user', JSON.stringify(testUser));
            log(output, 'âœ“ Test user created and saved', 'success');
            log(output, `Email: ${testUser.email}`, 'info');
            log(output, `Name: ${testUser.full_name}`, 'info');
            log(output, 'Now you can test the save function above', 'info');
        }

        function simulateSave() {
            const output = 'saveOutput';
            document.getElementById(output).innerHTML = '';
            
            const name = document.getElementById('testName').value.trim();
            const phone = document.getElementById('testPhone').value.trim();
            const address = document.getElementById('testAddress').value.trim();
            
            log(output, 'Simulating profile save...', 'info');
            
            if (!name || !phone || !address) {
                log(output, 'ERROR: Please fill in all fields', 'error');
                return;
            }
            
            log(output, `Saving - Name: "${name}"`, 'info');
            log(output, `Saving - Phone: "${phone}"`, 'info');
            log(output, `Saving - Address: "${address}"`, 'info');
            
            try {
                const user = JSON.parse(localStorage.getItem('user') || '{}');
                
                if (!user.email) {
                    log(output, 'ERROR: No existing user found. Create test user first!', 'error');
                    return;
                }
                
                user.full_name = name;
                user.phone = phone;
                user.address = address;
                
                localStorage.setItem('user', JSON.stringify(user));
                
                log(output, 'âœ“ Profile saved to localStorage', 'success');
                log(output, `New data saved:`, 'info');
                log(output, `${JSON.stringify(user, null, 2)}`, 'info');
            } catch (e) {
                log(output, `ERROR: ${e.message}`, 'error');
            }
        }

        function verifySave() {
            const output = 'verifyOutput';
            document.getElementById(output).innerHTML = '';
            
            log(output, 'Verifying saved data...', 'info');
            
            try {
                const user = JSON.parse(localStorage.getItem('user') || '{}');
                
                const name = document.getElementById('testName').value.trim();
                const phone = document.getElementById('testPhone').value.trim();
                const address = document.getElementById('testAddress').value.trim();
                
                if (user.full_name === name && user.phone === phone && user.address === address) {
                    log(output, 'âœ“ SAVE SUCCESSFUL!', 'success');
                    log(output, 'All data matches - profile save is working correctly', 'success');
                    log(output, `Saved Name: "${user.full_name}"`, 'info');
                    log(output, `Saved Phone: "${user.phone}"`, 'info');
                    log(output, `Saved Address: "${user.address}"`, 'info');
                } else {
                    log(output, 'âœ— MISMATCH - Save did not work properly', 'error');
                    log(output, `Expected Name: "${name}" | Got: "${user.full_name}"`, 'error');
                    log(output, `Expected Phone: "${phone}" | Got: "${user.phone}"`, 'error');
                    log(output, `Expected Address: "${address}" | Got: "${user.address}"`, 'error');
                }
            } catch (e) {
                log(output, `ERROR: ${e.message}`, 'error');
            }
        }

        function showAllStorage() {
            const output = 'verifyOutput';
            document.getElementById(output).innerHTML = '';
            
            log(output, 'All localStorage contents:', 'info');
            
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                const value = localStorage.getItem(key);
                
                if (key === 'user') {
                    log(output, `${key}: (parsed JSON below)`, 'info');
                    try {
                        const parsed = JSON.parse(value);
                        log(output, JSON.stringify(parsed, null, 2), 'info');
                    } catch (e) {
                        log(output, value, 'info');
                    }
                } else {
                    const displayValue = value.length > 100 ? value.substring(0, 100) + '...' : value;
                    log(output, `${key}: ${displayValue}`, 'info');
                }
            }
            
            if (localStorage.length === 0) {
                log(output, 'localStorage is empty', 'error');
            }
        }

        function openDevTools() {
            alert('Press F12 or Ctrl+Shift+I to open DevTools.\n\nUseful console commands:\nconsole.log(JSON.parse(localStorage.getItem("user")));\nJSON.parse(localStorage.getItem("user")).full_name');
        }

        function clearLocalStorage() {
            if (confirm('Clear ALL localStorage? This will delete all saved data!')) {
                localStorage.clear();
                alert('All data cleared');
            }
        }

        window.addEventListener('load', () => {
            console.log('Profile Save Test Page loaded');
        });
    </script>
</body>
</html>
